# 信息安全工程作业——挖矿算法模拟





## 0. 作业描述

比特币“挖矿”算法简化模拟	

参数：哈希函数采用SHA-256；挖矿难度为整数d（>0），代表哈希值前导字符串为0的数量，d值越小难度越小，d值越大难度越大

1. 随机生成一个整数x
2.  对x生成哈希值h=H(x)
3. 对h的前导字符串进行判定：如为d个0则挖矿成功；否则回到步骤1


输出：d=1，2，3，4，5时挖矿成功耗时（可取3组数平均值）





## 1. 实现算法

```python
import hashlib
import random
import time
from prettytable import PrettyTable							# 导入绘制表格的库

def mine(difficulty):
    prefix_str = '0' * difficulty							# 根据输入参数生成前导字符串
    attempts = 0											# 初始化步长计数器
    start_time = time.time()								# 获取当前程序开始运行的时间戳
    
    while True:
        x = random.randint(0, 2**32)  						# 随机生成一个整数
        h = hashlib.sha256(str(x).encode()).hexdigest()  	# 生成SHA-256哈希值
        attempts += 1										# 计算步长
        if h.startswith(prefix_str):  						# 检查哈希值前导字符串
            print(f"当前取的随机整数为:{x}")
            print(f"当前符合要求的哈希值为:{h}")
            break
    
    end_time = time.time()									# 获取当前程序运行结束的时间戳
    return end_time - start_time, attempts					# 返回挖矿消耗的时间和相应while运行次数

def average_mining_time(difficulty, iterations=3):
    total_time = 0
    total_attempts = 0
    
    for _ in range(iterations):
        elapsed_time, attempts = mine(difficulty)
        total_time += elapsed_time
        total_attempts += attempts
        print(f"Difficulty为:{difficulty}, 挖矿时间 = {elapsed_time:.6f}s, 挖矿步长 = {attempts}")

    average_time = total_time / iterations
    average_attempts = total_attempts / iterations
    
    print(f"\033[1;31mDifficulty为{difficulty}, 挖矿平均时间={average_time:.6f}s, 挖矿平均步长 = {average_attempts:.2f}\033[0m")
    # 红色文字展示，容易分辨
    
    return average_time,average_attempts

# 创建表格,易于展示
table = PrettyTable()
table.field_names = ["Difficulty (d)", "挖矿平均时间(s)","挖矿平均步长(step)"]    

# 不同挖矿难度遍历执行
for d in range(1, 8):
    average_time,average_attempts = average_mining_time(d)
    table.add_row([d, f"{average_time:.6f}",f"{average_attempts:.2f}"])

print(table)
```





## 2. 运行结果



由于每次运行结果的差异都是不确定的，但是总的来说difficulty的值越大，耗费时间就越长。这里选取某一分辨较好的运行结果作为展示。

因为程序使用随机数来进行取值，所以在某些情况下有最优解，当然最坏的情况就是2**32次遍历。



```
当前取的随机整数为:3696789060
当前符合要求的哈希值为:0dd2e709945758eb8b1fb97e117cc27f8564073354c2d49e9949451a00b381c4
Difficulty为:1, 挖矿时间 = 0.001007s, 挖矿步长 = 75
当前取的随机整数为:3405745798
当前符合要求的哈希值为:09b249b1e26a3b6f48b72e6f360e339b6ae04f7c3c691268efc3b0d5c689a32b
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 10
当前取的随机整数为:1810442326
当前符合要求的哈希值为:06476d6992d99bb178d1bf3831fb2ec0ceb5a6c84b5e0661db0130b24acebd7d
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 6
Difficulty为1, 挖矿平均时间=0.000336s, 挖矿平均步长 = 30.33
当前取的随机整数为:1769019426
当前符合要求的哈希值为:0054d5f7ad3e62f8681fe65f1ccf5bc94f68459593246722ab2b3c5b3f23d4f0
Difficulty为:2, 挖矿时间 = 0.000000s, 挖矿步长 = 64
当前取的随机整数为:760331474
当前符合要求的哈希值为:00aa62e29a6c342b17d1122064123102280b9087a21972d6b51135ea3de113d7
Difficulty为:2, 挖矿时间 = 0.001107s, 挖矿步长 = 362
当前取的随机整数为:108091365
当前符合要求的哈希值为:009f9f82d530307513e6b1d83afc20fbc5d87758b5dec70515067c07bb9aa980
Difficulty为:2, 挖矿时间 = 0.001015s, 挖矿步长 = 153
Difficulty为2, 挖矿平均时间=0.000707s, 挖矿平均步长 = 193.00
当前取的随机整数为:1074539291
当前符合要求的哈希值为:0009a32a2f97c3bfcf0f4290c3785a72b5f9b6503fd590491835eead9591dd28
Difficulty为:3, 挖矿时间 = 0.001021s, 挖矿步长 = 777
当前取的随机整数为:1223974109
当前符合要求的哈希值为:000aff73e3ab52a08b0046cf4fbf40f106b802136ccdba7f5e3b27123e6aca76
Difficulty为:3, 挖矿时间 = 0.009270s, 挖矿步长 = 2926
当前取的随机整数为:101501561
当前符合要求的哈希值为:000cd190f892c5c50ca7e14aaf27ff7d24b7658ab8820d9dcfb3c6eeca7a14de
Difficulty为:3, 挖矿时间 = 0.043366s, 挖矿步长 = 14319
Difficulty为3, 挖矿平均时间=0.017886s, 挖矿平均步长 = 6007.33
当前取的随机整数为:1756292686
当前符合要求的哈希值为:0000dab34c55e11ea74136f5cd8a994df41143bf0e6bcddda1407da1e1676a80
Difficulty为:4, 挖矿时间 = 0.248495s, 挖矿步长 = 81545
当前取的随机整数为:1815141777
当前符合要求的哈希值为:0000ee1d8aff34e6fe42b898dde491e42ce02e4213a1b46b4d05f3c001ce031d
Difficulty为:4, 挖矿时间 = 0.115979s, 挖矿步长 = 43001
当前取的随机整数为:670380251
当前符合要求的哈希值为:00000ad3a36ca5abd16be83890bda51c41c339795338226bd18643199580a77b
Difficulty为:4, 挖矿时间 = 0.063094s, 挖矿步长 = 18490
Difficulty为4, 挖矿平均时间=0.142523s, 挖矿平均步长 = 47678.67
当前取的随机整数为:507045335
当前符合要求的哈希值为:000004cdb03979e2c6900b9e380179052de0ea4c0c93976115399944f5b4ac92
Difficulty为:5, 挖矿时间 = 1.128444s, 挖矿步长 = 376439
当前取的随机整数为:4187377576
当前符合要求的哈希值为:000004779fced314d7685e838f87e0bf827ad79f69b88f170634da920c009820
Difficulty为:5, 挖矿时间 = 1.953277s, 挖矿步长 = 597805
当前取的随机整数为:620574440
当前符合要求的哈希值为:00000cdb56d079e208ce36e5f4d4fecd2af0bf1e5fc9e0f8cd2f6d1e016b4fdb
Difficulty为:5, 挖矿时间 = 0.199678s, 挖矿步长 = 54877
Difficulty为5, 挖矿平均时间=1.093800s, 挖矿平均步长 = 343040.33
当前取的随机整数为:4127342147
当前符合要求的哈希值为:000000e8b9ce442aa6e07617d11a96cdd212bc98b4b6071309d40aaa2acfae6d
Difficulty为:6, 挖矿时间 = 27.978750s, 挖矿步长 = 8164941
当前取的随机整数为:2436297719
当前符合要求的哈希值为:000000e17c5ef434941c7058755c283d7552587c77466757a1e6786018599871
Difficulty为:6, 挖矿时间 = 66.471643s, 挖矿步长 = 20098978
当前取的随机整数为:2916941158
当前符合要求的哈希值为:000000b62402c17990a6f0c502563010d618baf9a40adb84573948d18f51d789
Difficulty为:6, 挖矿时间 = 0.019322s, 挖矿步长 = 7247
Difficulty为6, 挖矿平均时间=31.489905s, 挖矿平均步长 = 9423722.00
当前取的随机整数为:939146957
当前符合要求的哈希值为:000000068190c8b5ec2744a49c3201d6a431b2deb1517d0a7d2ceb11a09e4208
Difficulty为:7, 挖矿时间 = 1002.243037s, 挖矿步长 = 292808854
当前取的随机整数为:3772744375
当前符合要求的哈希值为:00000005ffefa27bb122925790a484c53cf8ccf22bfa544dff22f41b626b6db1
Difficulty为:7, 挖矿时间 = 7.267559s, 挖矿步长 = 2209460
当前取的随机整数为:3349448012
当前符合要求的哈希值为:00000007fcca374e56156ac59de73b7d6642b13320db95d4e728faf9fe8e272f
Difficulty为:7, 挖矿时间 = 1243.739244s, 挖矿步长 = 377991114
Difficulty为7, 挖矿平均时间=751.083280s, 挖矿平均步长 = 224336476.00
+----------------+-----------------+--------------------+
| Difficulty (d) | 挖矿平均时间(s) | 挖矿平均步长(step) |
+----------------+-----------------+--------------------+
|       1        |     0.000336    |       30.33        |
|       2        |     0.000707    |       193.00       |
|       3        |     0.017886    |      6007.33       |
|       4        |     0.142523    |      47678.67      |
|       5        |     1.093800    |     343040.33      |
|       6        |    31.489905    |     9423722.00     |
|       7        |    751.083280   |    224336476.00    |
+----------------+-----------------+--------------------+
```



