# 信息安全工程作业——挖矿算法模拟



作业人：`ZhangJunTian`



[TOC]

## 0.  作业描述

比特币“挖矿”算法简化模拟	

参数：哈希函数采用SHA-256；挖矿难度为整数d（>0），代表哈希值前导字符串为0的数量，d值越小难度越小，d值越大难度越大

1. 随机生成一个整数x
2.  对x生成哈希值h=H(x)
3. 对h的前导字符串进行判定：如为d个0则挖矿成功；否则回到步骤1


输出：d=1，2，3，4，5时挖矿成功耗时（可取3组数平均值）





## 1.  实现算法

```python
import hashlib												# 导入哈希函数库
import random												# 导入随机数函数
import time													# 导入时间模块
from prettytable import PrettyTable							# 导入绘制表格的库
# 导入numpy库，里面也有random函数，也是可以的。

def mine(difficulty):
    prefix_str = '0' * difficulty							# 根据输入参数生成前导字符串
    attempts = 0											# 初始化步长计数器
    start_time = time.time()								# 获取当前程序开始运行的时间戳
    														# 256位哈希值就是64个十六进制字符
    while True:
        x = random.randint(0, 2**32)  						# 随机生成一个整数
        h = hashlib.sha256(str(x).encode()).hexdigest()  	# 生成SHA-256哈希值，再转化为十六进制字符串
        attempts += 1										# 计算步长
        if h.startswith(prefix_str):  						# 检查哈希值前导字符串
            print(f"当前取的随机整数为:{x}")
            print(f"当前符合要求的哈希值为:{h}")
            break
    
    end_time = time.time()									# 获取当前程序运行结束的时间戳
    return end_time - start_time, attempts					# 返回挖矿消耗的时间和相应while运行次数

def average_mining_time(difficulty, iterations=3):			# 计算平均时长函数
    total_time = 0
    total_attempts = 0
    
    for _ in range(iterations):								# 每一次前导0的尝试
        elapsed_time, attempts = mine(difficulty)
        total_time += elapsed_time
        total_attempts += attempts
        print(f"Difficulty为:{difficulty}, 挖矿时间 = {elapsed_time:.6f}s, 挖矿步长 = {attempts}")

    average_time = total_time / iterations
    average_attempts = total_attempts / iterations
    
    print(f"\033[1;31mDifficulty为{difficulty}, 挖矿平均时间={average_time:.6f}s, 挖矿平均步长 = {average_attempts:.2f}\033[0m")
    # 红色文字展示，容易分辨
    
    return average_time,average_attempts

# 创建表格,易于展示
table = PrettyTable()
table.field_names = ["Difficulty (d)", "挖矿平均时间(s)","挖矿平均步长(step)"]    

# 不同挖矿难度遍历执行
for d in range(1, 8):
    average_time,average_attempts = average_mining_time(d)
    table.add_row([d, f"{average_time:.6f}",f"{average_attempts:.2f}"])

print(table)
```





## 2.  运行结果



由于每次运行结果的差异都是不确定的，但是总的来说difficulty的值越大，耗费时间就越长。这里选取某一分辨较好的运行结果作为展示。

因为程序使用随机数来进行取值，所以在某些情况下有最优解，当然最坏的情况就是2**32次遍历。



### 2.0 test1

```
当前取的随机整数为:3696789060
当前符合要求的哈希值为:0dd2e709945758eb8b1fb97e117cc27f8564073354c2d49e9949451a00b381c4
Difficulty为:1, 挖矿时间 = 0.001007s, 挖矿步长 = 75
当前取的随机整数为:3405745798
当前符合要求的哈希值为:09b249b1e26a3b6f48b72e6f360e339b6ae04f7c3c691268efc3b0d5c689a32b
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 10
当前取的随机整数为:1810442326
当前符合要求的哈希值为:06476d6992d99bb178d1bf3831fb2ec0ceb5a6c84b5e0661db0130b24acebd7d
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 6
Difficulty为1, 挖矿平均时间=0.000336s, 挖矿平均步长 = 30.33
当前取的随机整数为:1769019426
当前符合要求的哈希值为:0054d5f7ad3e62f8681fe65f1ccf5bc94f68459593246722ab2b3c5b3f23d4f0
Difficulty为:2, 挖矿时间 = 0.000000s, 挖矿步长 = 64
当前取的随机整数为:760331474
当前符合要求的哈希值为:00aa62e29a6c342b17d1122064123102280b9087a21972d6b51135ea3de113d7
Difficulty为:2, 挖矿时间 = 0.001107s, 挖矿步长 = 362
当前取的随机整数为:108091365
当前符合要求的哈希值为:009f9f82d530307513e6b1d83afc20fbc5d87758b5dec70515067c07bb9aa980
Difficulty为:2, 挖矿时间 = 0.001015s, 挖矿步长 = 153
Difficulty为2, 挖矿平均时间=0.000707s, 挖矿平均步长 = 193.00
当前取的随机整数为:1074539291
当前符合要求的哈希值为:0009a32a2f97c3bfcf0f4290c3785a72b5f9b6503fd590491835eead9591dd28
Difficulty为:3, 挖矿时间 = 0.001021s, 挖矿步长 = 777
当前取的随机整数为:1223974109
当前符合要求的哈希值为:000aff73e3ab52a08b0046cf4fbf40f106b802136ccdba7f5e3b27123e6aca76
Difficulty为:3, 挖矿时间 = 0.009270s, 挖矿步长 = 2926
当前取的随机整数为:101501561
当前符合要求的哈希值为:000cd190f892c5c50ca7e14aaf27ff7d24b7658ab8820d9dcfb3c6eeca7a14de
Difficulty为:3, 挖矿时间 = 0.043366s, 挖矿步长 = 14319
Difficulty为3, 挖矿平均时间=0.017886s, 挖矿平均步长 = 6007.33
当前取的随机整数为:1756292686
当前符合要求的哈希值为:0000dab34c55e11ea74136f5cd8a994df41143bf0e6bcddda1407da1e1676a80
Difficulty为:4, 挖矿时间 = 0.248495s, 挖矿步长 = 81545
当前取的随机整数为:1815141777
当前符合要求的哈希值为:0000ee1d8aff34e6fe42b898dde491e42ce02e4213a1b46b4d05f3c001ce031d
Difficulty为:4, 挖矿时间 = 0.115979s, 挖矿步长 = 43001
当前取的随机整数为:670380251
当前符合要求的哈希值为:00000ad3a36ca5abd16be83890bda51c41c339795338226bd18643199580a77b
Difficulty为:4, 挖矿时间 = 0.063094s, 挖矿步长 = 18490
Difficulty为4, 挖矿平均时间=0.142523s, 挖矿平均步长 = 47678.67
当前取的随机整数为:507045335
当前符合要求的哈希值为:000004cdb03979e2c6900b9e380179052de0ea4c0c93976115399944f5b4ac92
Difficulty为:5, 挖矿时间 = 1.128444s, 挖矿步长 = 376439
当前取的随机整数为:4187377576
当前符合要求的哈希值为:000004779fced314d7685e838f87e0bf827ad79f69b88f170634da920c009820
Difficulty为:5, 挖矿时间 = 1.953277s, 挖矿步长 = 597805
当前取的随机整数为:620574440
当前符合要求的哈希值为:00000cdb56d079e208ce36e5f4d4fecd2af0bf1e5fc9e0f8cd2f6d1e016b4fdb
Difficulty为:5, 挖矿时间 = 0.199678s, 挖矿步长 = 54877
Difficulty为5, 挖矿平均时间=1.093800s, 挖矿平均步长 = 343040.33
当前取的随机整数为:4127342147
当前符合要求的哈希值为:000000e8b9ce442aa6e07617d11a96cdd212bc98b4b6071309d40aaa2acfae6d
Difficulty为:6, 挖矿时间 = 27.978750s, 挖矿步长 = 8164941
当前取的随机整数为:2436297719
当前符合要求的哈希值为:000000e17c5ef434941c7058755c283d7552587c77466757a1e6786018599871
Difficulty为:6, 挖矿时间 = 66.471643s, 挖矿步长 = 20098978
当前取的随机整数为:2916941158
当前符合要求的哈希值为:000000b62402c17990a6f0c502563010d618baf9a40adb84573948d18f51d789
Difficulty为:6, 挖矿时间 = 0.019322s, 挖矿步长 = 7247
Difficulty为6, 挖矿平均时间=31.489905s, 挖矿平均步长 = 9423722.00
当前取的随机整数为:939146957
当前符合要求的哈希值为:000000068190c8b5ec2744a49c3201d6a431b2deb1517d0a7d2ceb11a09e4208
Difficulty为:7, 挖矿时间 = 1002.243037s, 挖矿步长 = 292808854
当前取的随机整数为:3772744375
当前符合要求的哈希值为:00000005ffefa27bb122925790a484c53cf8ccf22bfa544dff22f41b626b6db1
Difficulty为:7, 挖矿时间 = 7.267559s, 挖矿步长 = 2209460
当前取的随机整数为:3349448012
当前符合要求的哈希值为:00000007fcca374e56156ac59de73b7d6642b13320db95d4e728faf9fe8e272f
Difficulty为:7, 挖矿时间 = 1243.739244s, 挖矿步长 = 377991114
Difficulty为7, 挖矿平均时间=751.083280s, 挖矿平均步长 = 224336476.00
+----------------+-----------------+--------------------+
| Difficulty (d) | 挖矿平均时间(s)   | 挖矿平均步长(step)   |
+----------------+-----------------+--------------------+
|       1        |     0.000336    |       30.33        |
|       2        |     0.000707    |       193.00       |
|       3        |     0.017886    |      6007.33       |
|       4        |     0.142523    |      47678.67      |
|       5        |     1.093800    |     343040.33      |
|       6        |    31.489905    |     9423722.00     |
|       7        |    751.083280   |    224336476.00    |
+----------------+-----------------+--------------------+
```







### 2.1 test2

运行结果：

```
当前取的随机整数为:1112561876
当前符合要求的哈希值为:0c017f0d7a0a71937a0c2c954238d49b7708dfbbe3956e0a1152e8e801bd9518
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 19
当前取的随机整数为:2810973809
当前符合要求的哈希值为:08d3e3af9df55c5da710132375ea2903257148298e6a898a1418e8d13c25eb71
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 23
当前取的随机整数为:2519272527
当前符合要求的哈希值为:0e366ebfa4dc5b819d87f5b1f3f0fad6e58590d402fba6a6e41931d6c03e9838
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 11
Difficulty为1, 挖矿平均时间=0.000000s, 挖矿平均步长 = 17.67
当前取的随机整数为:1011089603
当前符合要求的哈希值为:0046d22fb8a82f547e071452c21ca4943d4d40fc0863c310a8e9e851d72e84e8
Difficulty为:2, 挖矿时间 = 0.000000s, 挖矿步长 = 69
当前取的随机整数为:1699613990
当前符合要求的哈希值为:00efcb11efb1de73baaf74f1cb08fe5ea62e616d733d694716b9c17648871a33
Difficulty为:2, 挖矿时间 = 0.005647s, 挖矿步长 = 1791
当前取的随机整数为:2655654056
当前符合要求的哈希值为:0095baaf0ad25d9fceb42b1a1f606445ed143bc91606180b1cedd5a053125a20
Difficulty为:2, 挖矿时间 = 0.000998s, 挖矿步长 = 283
Difficulty为2, 挖矿平均时间=0.002215s, 挖矿平均步长 = 714.33
当前取的随机整数为:630473776
当前符合要求的哈希值为:0009e9e2b22fdd222aa3926bd8070014fea2725a47eab2fc6a1c17b4cafacb2b
Difficulty为:3, 挖矿时间 = 0.003461s, 挖矿步长 = 910
当前取的随机整数为:646370998
当前符合要求的哈希值为:000ca743a529c6117d96444553cb185c1250d76e7fe6be8ef2ed7d168c45c9d1
Difficulty为:3, 挖矿时间 = 0.001750s, 挖矿步长 = 324
当前取的随机整数为:3296752603
当前符合要求的哈希值为:000eb6e128c64f187c1c82772b5f0bd9596d680e25256ec4dd96d4594da05a09
Difficulty为:3, 挖矿时间 = 0.013299s, 挖矿步长 = 5314
Difficulty为3, 挖矿平均时间=0.006170s, 挖矿平均步长 = 2182.67
当前取的随机整数为:2103754074
当前符合要求的哈希值为:0000a57938e3c5b5b29030e9dd1aa4c4c62068f7437868a44a089b5fcb4e1aa8
Difficulty为:4, 挖矿时间 = 0.150403s, 挖矿步长 = 67185
当前取的随机整数为:2384666724
当前符合要求的哈希值为:0000cee24b37d3b3e91fe3e956e9c377ab82ebe935bb31e1acdccee9024833fa
Difficulty为:4, 挖矿时间 = 0.009429s, 挖矿步长 = 4883
当前取的随机整数为:911126637
当前符合要求的哈希值为:0000320009ffc058f7890758145d1ede55b90b60ab9e75c240480cedf27f8eef
Difficulty为:4, 挖矿时间 = 0.350115s, 挖矿步长 = 153494
Difficulty为4, 挖矿平均时间=0.169983s, 挖矿平均步长 = 75187.33
当前取的随机整数为:4182026068
当前符合要求的哈希值为:00000eb1da48776d690a3d4bb803fab0304b00267ab9c9c392a6795b4d756959
Difficulty为:5, 挖矿时间 = 0.184981s, 挖矿步长 = 92551
当前取的随机整数为:1545288657
当前符合要求的哈希值为:0000035327649e44851b64b6164dec82598d787498392abb1e08440821bac7ba
Difficulty为:5, 挖矿时间 = 1.367931s, 挖矿步长 = 627305
当前取的随机整数为:1725575388
当前符合要求的哈希值为:000000ceaa00d6da73ef54673c95001c28e615c5ca0760066c4215e3271b6096
Difficulty为:5, 挖矿时间 = 0.393458s, 挖矿步长 = 179997
Difficulty为5, 挖矿平均时间=0.648790s, 挖矿平均步长 = 299951.00
当前取的随机整数为:1369860881
当前符合要求的哈希值为:000000968cff0448ca0e334c4c7125b200002f045eac8f22dad22794919cd3f7
Difficulty为:6, 挖矿时间 = 67.251582s, 挖矿步长 = 30482725
当前取的随机整数为:1342030760
当前符合要求的哈希值为:0000007b51f7d557a9205a0e3b7e103bbe13c1e7803bd35f5d0e2e1bf60398c6
Difficulty为:6, 挖矿时间 = 8.202019s, 挖矿步长 = 3795850
当前取的随机整数为:1423315577
当前符合要求的哈希值为:000000778217f4bd1f34645d17ad4d982de13bf7d22ea419261d6397e689a4e8
Difficulty为:6, 挖矿时间 = 3.683883s, 挖矿步长 = 1696913
Difficulty为6, 挖矿平均时间=26.379161s, 挖矿平均步长 = 11991829.33
当前取的随机整数为:1316429626
当前符合要求的哈希值为:0000000eb243b12f99d8686bcc6d9954aac3e0bd8e376d182dfee4d21d3497b1
Difficulty为:7, 挖矿时间 = 343.678653s, 挖矿步长 = 162251868
当前取的随机整数为:426479724
当前符合要求的哈希值为:00000000690ed426ccf17803ebe2bd0884bcd58a1bb5e7477ead3645f356e7a9
Difficulty为:7, 挖矿时间 = 1468.090466s, 挖矿步长 = 700114939
当前取的随机整数为:426479724
当前符合要求的哈希值为:00000000690ed426ccf17803ebe2bd0884bcd58a1bb5e7477ead3645f356e7a9
Difficulty为:7, 挖矿时间 = 2624.310930s, 挖矿步长 = 1219477559
Difficulty为7, 挖矿平均时间=1478.693350s, 挖矿平均步长 = 693948122.00
+----------------+-----------------+--------------------+
| Difficulty (d) |  挖矿平均时间(s)  |  挖矿平均步长(step)  |
+----------------+-----------------+--------------------+
|       1        |     0.000000    |       17.67        |
|       2        |     0.002215    |       714.33       |
|       3        |     0.006170    |      2182.67       |
|       4        |     0.169983    |      75187.33      |
|       5        |     0.648790    |     299951.00      |
|       6        |    26.379161    |    11991829.33     |
|       7        |   1478.693350   |    693948122.00    |
+----------------+-----------------+--------------------+
```



test2运行截图

![image-20241121113304072](../_media/image-20241121113304072.png)







## 3.  系统资源

程序运行的时候系统资源占用情况：

![image-20241121101928367](../_media/image-20241121101928367.png)



可以看到`PyCharm`的内存占用，电脑带不动。

![image-20241121103139043](../_media/image-20241121103139043.png)







## 4.  实验结果

分析数据发现，难度小于5的时候，能够在1、2s内完成所有测试，但是可以看到随着难度的上升，平均挖矿时间也在上升

test1实验中难度为7的时候有一个非预期的，所以按照规律而言，平均时间应该可以达到$10^3$ s 这个量级

难度设置为8的时候，电脑得等很久，索性我就没有进行难度为8的测试。











## 5. 改进方案

### 5.0 多线程

挖矿算法是一个典型的多线程实验，需要注意：

- 生成随机数和计算哈希的任务分配给多个线程
- 然后确保一个线程计算出结果之后，其他线程立马退出，并且标记是哪一个线程挖到了矿
- 每个线程记录自己的尝试次数，最终由主线程汇总



==因为要实现多组实验，所以把挖矿难度改为（1，7），省去等待==

#### 5.0.1 程序代码实现

其他基本一致，加一个线程任务分配的函数而已，线程数一般是`cpu核心数*2`

```python
import hashlib
import random
import time
from threading import Thread, Event, Lock, local
from prettytable import PrettyTable

# 用于线程独立随机数种子
thread_data = local()


def generate_random():
    """生成独立随机数"""
    if not hasattr(thread_data, 'random_gen'):
        thread_data.random_gen = random.Random()  # 每个线程使用独立的随机生成器
        thread_data.random_gen.seed(random.randint(0, 2 ** 64))
    return thread_data.random_gen.randint(0, 2 ** 64)


class MinerThread(Thread):
    def __init__(self, difficulty, result_event, lock, results, thread_id):
        super().__init__()
        self.difficulty = difficulty
        self.result_event = result_event
        self.lock = lock
        self.results = results
        self.thread_id = thread_id

    def run(self):
        prefix_str = '0' * self.difficulty
        attempts = 0
        start_time = time.time()

        while not self.result_event.is_set():
            x = generate_random()
            h = hashlib.sha256(str(x).encode()).hexdigest()
            attempts += 1
            if h.startswith(prefix_str):  # 找到符合难度的哈希值
                with self.lock:
                    self.results['winner'] = self.thread_id
                    self.results['random_number'] = x
                    self.results['hash'] = h
                    self.results['attempts'] = attempts
                    self.results['time'] = time.time() - start_time
                self.result_event.set()
                break


def multi_thread_mining(difficulty, thread_count=4):
    """多线程挖矿"""
    result_event = Event()
    lock = Lock()
    results = {}

    threads = [MinerThread(difficulty, result_event, lock, results, i) for i in range(thread_count)]

    for thread in threads:
        thread.start()

    for thread in threads:
        thread.join()

    return results


def average_mining_time(difficulty, iterations=3, thread_count=4):
    """计算多线程挖矿平均时间和步长"""
    total_time = 0
    total_attempts = 0

    for _ in range(iterations):
        results = multi_thread_mining(difficulty, thread_count)
        elapsed_time = results['time']
        attempts = results['attempts']
        total_time += elapsed_time
        total_attempts += attempts
        print(f"Difficulty={difficulty}, 线程{results['winner']}找到结果，挖矿时间={elapsed_time:.6f}s, 步长={attempts}")

    average_time = total_time / iterations
    average_attempts = total_attempts / iterations

    print(
        f"\033[1;31mDifficulty={difficulty}, 平均挖矿时间={average_time:.6f}s, 平均步长={average_attempts:.2f}\033[0m")
    return average_time, average_attempts


# 创建表格，易于展示
table = PrettyTable()
table.field_names = ["Difficulty (d)", "挖矿平均时间(s)", "挖矿平均步长(step)"]

# 不同挖矿难度遍历执行
for d in range(1, 7):
    avg_time, avg_attempts = average_mining_time(d, thread_count=4)
    table.add_row([d, f"{avg_time:.6f}", f"{avg_attempts:.2f}"])

print(table)

```





#### 5.0.2 一次运行结果

打印出来的时间并不是我们需要等待的时间，它是系统等待的时间，

总的来说我们每个难度运行三次之后，所耗费的时间就是各个难度中耗时最长的加在一起

```
Difficulty=1, 线程0找到结果，挖矿时间=0.000000s, 步长=34
Difficulty=1, 线程0找到结果，挖矿时间=0.000000s, 步长=21
Difficulty=1, 线程0找到结果，挖矿时间=0.000000s, 步长=29
Difficulty=1, 平均挖矿时间=0.000000s, 平均步长=28.00
Difficulty=2, 线程0找到结果，挖矿时间=0.001198s, 步长=119
Difficulty=2, 线程0找到结果，挖矿时间=0.002995s, 步长=1044
Difficulty=2, 线程0找到结果，挖矿时间=0.000000s, 步长=205
Difficulty=2, 平均挖矿时间=0.001398s, 平均步长=456.00
Difficulty=3, 线程0找到结果，挖矿时间=0.000996s, 步长=502
Difficulty=3, 线程0找到结果，挖矿时间=0.012813s, 步长=4931
Difficulty=3, 线程0找到结果，挖矿时间=0.004119s, 步长=1722
Difficulty=3, 平均挖矿时间=0.005976s, 平均步长=2385.00
Difficulty=4, 线程2找到结果，挖矿时间=0.511022s, 步长=72758
Difficulty=4, 线程0找到结果，挖矿时间=0.018435s, 步长=7019
Difficulty=4, 线程1找到结果，挖矿时间=0.578429s, 步长=69501
Difficulty=4, 平均挖矿时间=0.369295s, 平均步长=49759.33
Difficulty=5, 线程3找到结果，挖矿时间=1.580793s, 步长=174581
Difficulty=5, 线程3找到结果，挖矿时间=8.956888s, 步长=995410
Difficulty=5, 线程2找到结果，挖矿时间=0.456538s, 步长=41350
Difficulty=5, 平均挖矿时间=3.664740s, 平均步长=403780.33
Difficulty=6, 线程1找到结果，挖矿时间=2.924537s, 步长=295059
Difficulty=6, 线程2找到结果，挖矿时间=0.730769s, 步长=81648
Difficulty=6, 线程1找到结果，挖矿时间=16.788357s, 步长=1878208
Difficulty=6, 平均挖矿时间=6.814555s, 平均步长=751638.33
+----------------+-----------------+--------------------+
| Difficulty (d) | 挖矿平均时间(s) | 挖矿平均步长(step) |
+----------------+-----------------+--------------------+
|       1        |     0.000000    |       28.00        |
|       2        |     0.001398    |       456.00       |
|       3        |     0.005976    |      2385.00       |
|       4        |     0.369295    |      49759.33      |
|       5        |     3.664740    |     403780.33      |
|       6        |     6.814555    |     751638.33      |
+----------------+-----------------+--------------------+
```





#### 5.0.3 系统资源消耗

![image-20241128101224432](../_media/image-20241128101224432.png)







### 5.1 大随机数

将原本实验的[0,2\*\*32] ，改为[0,2\*\*256] ，同理难度就设为（1，7），程序同上：

运行结果如下：

```
当前取的随机整数为:14722025705844041475
当前符合要求的哈希值为:0f38443905940f23d8e872a9c40aa8dbf7ebde1d9d7002844008d9ec07ff34a7
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 6
当前取的随机整数为:8048208762154468664
当前符合要求的哈希值为:043e28b7ae5d2f872acfbf773ef172b8df8a9c70a29d0d77cf166e1358e21e89
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 13
当前取的随机整数为:16240009209983885501
当前符合要求的哈希值为:0dc1e266cd0799887935d84b2656d1819c010359cc4958424cb2946fd0f49cd8
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 4
Difficulty为1, 挖矿平均时间=0.000000s, 挖矿平均步长 = 7.67
当前取的随机整数为:10530558838973771976
当前符合要求的哈希值为:00115fb5d14ab1b0c2c975aa0b1d193ae3148fc236601566c55da8fda1a93906
Difficulty为:2, 挖矿时间 = 0.000000s, 挖矿步长 = 213
当前取的随机整数为:3821034091943056912
当前符合要求的哈希值为:00ddec7aeb1e7ecd9142c8d6219cdbf989ecd15978c90a8c8a9ba34224c7be9e
Difficulty为:2, 挖矿时间 = 0.000000s, 挖矿步长 = 140
当前取的随机整数为:9787129476543184570
当前符合要求的哈希值为:009bc7dc9e6f6bf00ad6d9cb8313e83b0f2f81d72b10ade6b4037091b0db5724
Difficulty为:2, 挖矿时间 = 0.001031s, 挖矿步长 = 6
Difficulty为2, 挖矿平均时间=0.000344s, 挖矿平均步长 = 119.67
当前取的随机整数为:14107377506651202322
当前符合要求的哈希值为:000e34fb506fe697bb53fbd748e17988ec33d92fcc019b2f89a965dd05ef3f7d
Difficulty为:3, 挖矿时间 = 0.001997s, 挖矿步长 = 1088
当前取的随机整数为:12374368304216173986
当前符合要求的哈希值为:000bbf8fe0d083b453463ce8be1bbdd16034e3b96bdbcf3d739c4e363ed61167
Difficulty为:3, 挖矿时间 = 0.000000s, 挖矿步长 = 321
当前取的随机整数为:13624489269283205542
当前符合要求的哈希值为:0008c43dffd6b1f88b82dba6b027654643f5f95420f3bbc86478ce9777d7599e
Difficulty为:3, 挖矿时间 = 0.005773s, 挖矿步长 = 2368
Difficulty为3, 挖矿平均时间=0.002590s, 挖矿平均步长 = 1259.00
当前取的随机整数为:10488621178625780991
当前符合要求的哈希值为:0000113b68db412f759552ecc150c9e8e3c917c6e575066c99a4dcd79372f292
Difficulty为:4, 挖矿时间 = 0.248444s, 挖矿步长 = 115577
当前取的随机整数为:7789840047134724134
当前符合要求的哈希值为:0000fb786654e5f962e1451ef2b0c89ac82c5759a80d9c39cfff80409bf65893
Difficulty为:4, 挖矿时间 = 0.037952s, 挖矿步长 = 16665
当前取的随机整数为:4946190844596958001
当前符合要求的哈希值为:000097221a85c9ac223a183aa2d67a68acdb390f3d982d28febecdfd6da53605
Difficulty为:4, 挖矿时间 = 0.098003s, 挖矿步长 = 46613
Difficulty为4, 挖矿平均时间=0.128133s, 挖矿平均步长 = 59618.33
当前取的随机整数为:9959048215750963516
当前符合要求的哈希值为:00000fec0240da0a51954ecdc1e3a1b280d1fbd9304e6bf47e496eef561d7d18
Difficulty为:5, 挖矿时间 = 4.973498s, 挖矿步长 = 2420637
当前取的随机整数为:9863911854079258638
当前符合要求的哈希值为:00000bb8caff69a29c580fee297458262314a4563820831d53434b78682e64e0
Difficulty为:5, 挖矿时间 = 7.520854s, 挖矿步长 = 3643209
当前取的随机整数为:13441697926143543777
当前符合要求的哈希值为:00000f9139ed01256e15ce2dea9bb6c7b29364200016eb6ca9897894987a57ff
Difficulty为:5, 挖矿时间 = 3.115241s, 挖矿步长 = 1509146
Difficulty为5, 挖矿平均时间=5.203198s, 挖矿平均步长 = 2524330.67
当前取的随机整数为:6742428490699267702
当前符合要求的哈希值为:0000006a9d38710e4657e9ffd3bbd6b6410231aae9d8f03bb2b9dd3f6cdf46c9
Difficulty为:6, 挖矿时间 = 40.845672s, 挖矿步长 = 19080380
当前取的随机整数为:4819821616798309456
当前符合要求的哈希值为:00000099c1b1402c5a27ded06429ee9d44fbb849ec7cbf59e5b1713a444265b7
Difficulty为:6, 挖矿时间 = 13.785283s, 挖矿步长 = 6478392
当前取的随机整数为:14025598048386623457
当前符合要求的哈希值为:00000016b4a87f2211c232ceadeb437701a395142e340bed44efa1e6d219ec60
Difficulty为:6, 挖矿时间 = 10.372043s, 挖矿步长 = 4911688
Difficulty为6, 挖矿平均时间=21.667666s, 挖矿平均步长 = 10156820.00
+----------------+-----------------+--------------------+
| Difficulty (d) | 挖矿平均时间(s) | 挖矿平均步长(step) |
+----------------+-----------------+--------------------+
|       1        |     0.000000    |        7.67        |
|       2        |     0.000344    |       119.67       |
|       3        |     0.002590    |      1259.00       |
|       4        |     0.128133    |      59618.33      |
|       5        |     5.203198    |     2524330.67     |
|       6        |    21.667666    |    10156820.00     |
+----------------+-----------------+--------------------+
```

对于前导零较小的实验来说，可能区别不太大。

<img src="../_media/image-20241128104927137.png" alt="image-20241128104927137" style="zoom:150%;" />





### 5.2 C++语言实现

#### 5.2.0 编译

openssl库要安装，不然就在linux环境下跑

编译，因为环境问题，所以指定一下版本号和openssl库的环境

```
g++ -std=c++17 -o testt testt.cpp -lssl -lcrypto
```



#### 5.2.1 实现程序

```cpp
#include <iostream>
#include <iomanip>
#include <random>
#include <chrono>
#include <openssl/sha.h>
#include <string>
#include <sstream>
#include <vector>

// 生成SHA-256哈希值
std::string sha256(const std::string &input) {
    unsigned char hash[SHA256_DIGEST_LENGTH];
    SHA256(reinterpret_cast<const unsigned char *>(input.c_str()), input.size(), hash);
    
    std::stringstream ss;
    for (int i = 0; i < SHA256_DIGEST_LENGTH; ++i) {
        ss << std::hex << std::setw(2) << std::setfill('0') << (int)hash[i];
    }
    return ss.str();
}

// 挖矿函数
std::pair<double, int> mine(int difficulty) {
    std::string prefix_str(difficulty, '0'); // 前导0字符串
    int attempts = 0; // 步长计数器
    auto start_time = std::chrono::high_resolution_clock::now();

    std::random_device rd;
    std::mt19937 gen(rd());
    std::uniform_int_distribution<unsigned int> dis(0, UINT32_MAX);

    while (true) {
        unsigned int x = dis(gen); // 随机生成一个整数
        std::string hash = sha256(std::to_string(x)); // 计算SHA-256哈希值
        attempts++; // 计算步长
        if (hash.substr(0, difficulty) == prefix_str) { // 检查哈希值的前导字符串
            std::cout << "当前取的随机整数为: " << x << std::endl;
            std::cout << "当前符合要求的哈希值为: " << hash << std::endl;
            break;
        }
    }

    auto end_time = std::chrono::high_resolution_clock::now();
    std::chrono::duration<double> elapsed = end_time - start_time;
    return {elapsed.count(), attempts};
}

// 计算平均挖矿时间和步长
std::pair<double, double> average_mining_time(int difficulty, int iterations = 3) {
    double total_time = 0;
    int total_attempts = 0;

    for (int i = 0; i < iterations; ++i) {
        auto [elapsed_time, attempts] = mine(difficulty);
        total_time += elapsed_time;
        total_attempts += attempts;
        std::cout << "Difficulty为: " << difficulty 
                  << ", 挖矿时间 = " << elapsed_time << "s, 挖矿步长 = " << attempts << std::endl;
    }

    double average_time = total_time / iterations;
    double average_attempts = static_cast<double>(total_attempts) / iterations;

    std::cout << "\033[1;31mDifficulty为" << difficulty 
              << ", 挖矿平均时间 = " << average_time 
              << "s, 挖矿平均步长 = " << average_attempts 
              << "\033[0m" << std::endl;

    return {average_time, average_attempts};
}

int main() {
    std::cout << std::left << std::setw(15) << "Difficulty (d)" 
              << std::setw(25) << "挖矿平均时间(s)" 
              << "挖矿平均步长(step)" << std::endl;

    for (int d = 1; d <= 6; ++d) {
        auto [average_time, average_attempts] = average_mining_time(d);
        std::cout << std::left << std::setw(15) << d 
                  << std::setw(25) << average_time 
                  << average_attempts << std::endl;
    }

    return 0;
}

```



#### 5.2.2 运行结果

```
root@vm:~# !102
g++ -std=c++17 -o testt testt.cpp -lssl -lcrypto
root@vm:~# ./testt
Difficulty (d) 挖矿平均时间(s)    挖矿平均步长(step)
当前取的随机整数为: 4095947157
当前符合要求的哈希值为: 08153e70f8fcbf4a2b04fbac176d38d4b9f88e58c1ea9faa69d64a07bd52dc9a
Difficulty为: 1, 挖矿时间 = 0.000104612s, 挖矿步长 = 10
当前取的随机整数为: 2667973627
当前符合要求的哈希值为: 0d2bab09bc13e8dae9ec6bbaa01434d488fa656d64cb9a481a0c791d9d12a488
Difficulty为: 1, 挖矿时间 = 4.6062e-05s, 挖矿步长 = 4
当前取的随机整数为: 1837710762
当前符合要求的哈希值为: 0a18b4da60c03cde576c77a46c903de36db1511b218d05ca136fde74fc1c3c54
Difficulty为: 1, 挖矿时间 = 3.6262e-05s, 挖矿步长 = 2
Difficulty为1, 挖矿平均时间 = 6.2312e-05s, 挖矿平均步长 = 5.33333
1              6.2312e-05               5.33333
当前取的随机整数为: 2055939790
当前符合要求的哈希值为: 0096bd53fab7ff2ee8900f067994c7907617dfcbb6502e707c0c46609ba88f95
Difficulty为: 2, 挖矿时间 = 0.00155695s, 挖矿步长 = 452
当前取的随机整数为: 865295290
当前符合要求的哈希值为: 0093491fe9cefd8af825ad2f026d98a94b5fbcc95aa581734648ce628b2c0127
Difficulty为: 2, 挖矿时间 = 0.00113879s, 挖矿步长 = 353
当前取的随机整数为: 225596544
当前符合要求的哈希值为: 009a27ffd907b3c5f368699afb41384c2c1dc26b743b2d26d726b1849b2d114d
Difficulty为: 2, 挖矿时间 = 0.000301496s, 挖矿步长 = 85
Difficulty为2, 挖矿平均时间 = 0.000999078s, 挖矿平均步长 = 296.667
2              0.000999078              296.667
当前取的随机整数为: 859674436
当前符合要求的哈希值为: 0008556553a8e7b5da0c0e40b53b75724b1c1e975e1bdb2292cb02146735fcd8
Difficulty为: 3, 挖矿时间 = 0.0104028s, 挖矿步长 = 3222
当前取的随机整数为: 428367396
当前符合要求的哈希值为: 0007f71ca42c7e7cb0a10dca782ba5a28edc863fe77a2191ce2a18407545dc19
Difficulty为: 3, 挖矿时间 = 0.0207486s, 挖矿步长 = 6407
当前取的随机整数为: 4252231771
当前符合要求的哈希值为: 000b7dc6a997cd6ee9abcdbb9336439e84771ad08978ef6faced7004401a27ce
Difficulty为: 3, 挖矿时间 = 0.0572081s, 挖矿步长 = 17502
Difficulty为3, 挖矿平均时间 = 0.0294531s, 挖矿平均步长 = 9043.67
3              0.0294531                9043.67
当前取的随机整数为: 1332222061
当前符合要求的哈希值为: 000063d20d68c7fbea5c5676b72a5bdc957ce31aa8c76e72b98fcda7c3776bcd
Difficulty为: 4, 挖矿时间 = 0.0615024s, 挖矿步长 = 19201
当前取的随机整数为: 1769422308
当前符合要求的哈希值为: 0000eff77ed8c207e0d50f3a331520dd1dfca6c2ee2cae656d1c35b69c563e05
Difficulty为: 4, 挖矿时间 = 0.0180558s, 挖矿步长 = 5380
当前取的随机整数为: 2085643290
当前符合要求的哈希值为: 0000769f9f2563b30dec321b15dfe0125d60d73897ceb012c3c5bbe2cca6dbfb
Difficulty为: 4, 挖矿时间 = 0.0615206s, 挖矿步长 = 19215
Difficulty为4, 挖矿平均时间 = 0.0470262s, 挖矿平均步长 = 14598.7
4              0.0470262                14598.7
当前取的随机整数为: 3561786749
当前符合要求的哈希值为: 00000ac262ae6b225cb7de238256a31723eabedb7efe84998701c41f25dca148
Difficulty为: 5, 挖矿时间 = 0.507348s, 挖矿步长 = 155397
当前取的随机整数为: 1307438890
当前符合要求的哈希值为: 000000298f0c4a46fe015d329dd9836694f2fd9df7f6b99ab19ecda34fc7317d
Difficulty为: 5, 挖矿时间 = 3.43236s, 挖矿步长 = 1064624
当前取的随机整数为: 1625211600
当前符合要求的哈希值为: 000000d42ce98280bc952d32e5a984dd4047b45b0dc61f96e9bf588ce2217136
Difficulty为: 5, 挖矿时间 = 1.5504s, 挖矿步长 = 492449
Difficulty为5, 挖矿平均时间 = 1.83003s, 挖矿平均步长 = 570823
5              1.83003                  570823
当前取的随机整数为: 3443399600
当前符合要求的哈希值为: 00000031b46faaaf8c4f2e0a4f37131f511917b2c30beed747f3862b6127803b
Difficulty为: 6, 挖矿时间 = 8.94917s, 挖矿步长 = 2840082
当前取的随机整数为: 2564365491
当前符合要求的哈希值为: 00000060f9cb7a0182980102c09d2d976e09fcc563dbc2375de006c538abe5cc
Difficulty为: 6, 挖矿时间 = 30.8525s, 挖矿步长 = 9523879
当前取的随机整数为: 175788102
当前符合要求的哈希值为: 000000c41dbb6098300831bf3ab4c94593103431087997e7f24be347eebaeca0
Difficulty为: 6, 挖矿时间 = 11.2396s, 挖矿步长 = 3391809
Difficulty为6, 挖矿平均时间 = 17.0138s, 挖矿平均步长 = 5.25192e+06
6              17.0138                  5.25192e+06
```



<img src="../_media/image-20241128110558768.png" alt="image-20241128110558768" style="zoom:150%;" />







### 5.3 其他哈希函数

#### 5.3.0 程序实现

基本上就是类似的，改一下哈希函数而已，这里就写一个数组进行遍历执行

```python
import hashlib  # 导入哈希函数库
import random  # 导入随机数函数
import time  # 导入时间模块
from prettytable import PrettyTable  # 导入绘制表格的库


def mine(difficulty, hash_algo='sha256'):  # 增加一个参数用于选择哈希算法
    prefix_str = '0' * difficulty  # 根据输入参数生成前导字符串
    attempts = 0  # 初始化步长计数器
    start_time = time.time()  # 获取当前程序开始运行的时间戳
    # 256位哈希值就是64个十六进制字符
    while True:
        x = random.randint(0, 2 ** 32)  # 随机生成一个整数

        # 根据选择的哈希算法生成对应的哈希值
        if hash_algo == 'sha256':
            h = hashlib.sha256(str(x).encode()).hexdigest()  # 生成SHA-256哈希值，再转化为十六进制字符串
        elif hash_algo == 'md5':
            h = hashlib.md5(str(x).encode()).hexdigest()  # 生成MD5哈希值
        elif hash_algo == 'sha1':
            h = hashlib.sha1(str(x).encode()).hexdigest()  # 生成SHA-1哈希值
        else:
            raise ValueError("Unsupported hash algorithm")

        attempts += 1  # 计算步长
        if h.startswith(prefix_str):  # 检查哈希值前导字符串
            print(f"当前取的随机整数为:{x}")
            print(f"当前符合要求的哈希值为:{h}")
            break

    end_time = time.time()  # 获取当前程序运行结束的时间戳
    return end_time - start_time, attempts  # 返回挖矿消耗的时间和相应while运行次数


def average_mining_time(difficulty, hash_algo='sha256', iterations=3):  # 传入哈希算法作为参数
    total_time = 0
    total_attempts = 0

    for _ in range(iterations):  # 每一次前导0的尝试
        elapsed_time, attempts = mine(difficulty, hash_algo)
        total_time += elapsed_time
        total_attempts += attempts
        print(f"Difficulty为:{difficulty}, 挖矿时间 = {elapsed_time:.6f}s, 挖矿步长 = {attempts}")

    average_time = total_time / iterations
    average_attempts = total_attempts / iterations

    print(
        f"\033[1;31mDifficulty为{difficulty}, 挖矿平均时间={average_time:.6f}s, 挖矿平均步长 = {average_attempts:.2f}\033[0m")
    # 红色文字展示，容易分辨

    return average_time, average_attempts


# 创建表格,易于展示
table = PrettyTable()
table.field_names = ["Difficulty (d)", "挖矿平均时间(s)", "挖矿平均步长(step)"]

# 可以根据需要设置不同的哈希算法
hash_algos = ['md5', 'sha1']

# 不同挖矿难度遍历执行
for hash_algo in hash_algos:
    print(f"使用哈希算法: {hash_algo.upper()}")
    for d in range(1, 8):
        average_time, average_attempts = average_mining_time(d, hash_algo)
        table.add_row([d, f"{average_time:.6f}", f"{average_attempts:.2f}"])

    print(table)
    print("\n" + "=" * 50 + "\n")

```



#### 5.3.1 md5运行结果

```
使用哈希算法: MD5
当前取的随机整数为:1055568562
当前符合要求的哈希值为:0642849ff3a05cf510d271d6d3cfa518
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 4
当前取的随机整数为:2338319253
当前符合要求的哈希值为:000e097e0147094c553b148658948568
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 12
当前取的随机整数为:2107234105
当前符合要求的哈希值为:05b2a833c557df7b0d4bb3e279301218
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 1
Difficulty为1, 挖矿平均时间=0.000000s, 挖矿平均步长 = 5.67
当前取的随机整数为:1254682910
当前符合要求的哈希值为:0019ba3a899d1b6a3e45b4a10eed9ede
Difficulty为:2, 挖矿时间 = 0.001997s, 挖矿步长 = 524
当前取的随机整数为:382010512
当前符合要求的哈希值为:00b292d506088f3524801dd9d3710845
Difficulty为:2, 挖矿时间 = 0.000000s, 挖矿步长 = 255
当前取的随机整数为:3016929743
当前符合要求的哈希值为:002f39ebcf6417c8629bfb47e0ce39b2
Difficulty为:2, 挖矿时间 = 0.000000s, 挖矿步长 = 58
Difficulty为2, 挖矿平均时间=0.000666s, 挖矿平均步长 = 279.00
当前取的随机整数为:1659660047
当前符合要求的哈希值为:000c7d953227decbe832decc093af911
Difficulty为:3, 挖矿时间 = 0.001994s, 挖矿步长 = 1187
当前取的随机整数为:1570791984
当前符合要求的哈希值为:000abdda930275831103c684c7324aa4
Difficulty为:3, 挖矿时间 = 0.008618s, 挖矿步长 = 4180
当前取的随机整数为:1523115485
当前符合要求的哈希值为:000c13fae0238797fcef2066675fd808
Difficulty为:3, 挖矿时间 = 0.017721s, 挖矿步长 = 9566
Difficulty为3, 挖矿平均时间=0.009444s, 挖矿平均步长 = 4977.67
当前取的随机整数为:103399298
当前符合要求的哈希值为:00003c7429f785b0abf93e5c081ad006
Difficulty为:4, 挖矿时间 = 0.016936s, 挖矿步长 = 8371
当前取的随机整数为:2399546446
当前符合要求的哈希值为:00007f341060724f6efef8235de2f113
Difficulty为:4, 挖矿时间 = 0.105044s, 挖矿步长 = 53978
当前取的随机整数为:3014540675
当前符合要求的哈希值为:000023eb9132856f89d01732a7316758
Difficulty为:4, 挖矿时间 = 0.006981s, 挖矿步长 = 3968
Difficulty为4, 挖矿平均时间=0.042987s, 挖矿平均步长 = 22105.67
当前取的随机整数为:3499718735
当前符合要求的哈希值为:0000029683f3e79d9ea23ad9977cbcf4
Difficulty为:5, 挖矿时间 = 1.110000s, 挖矿步长 = 551323
当前取的随机整数为:1206782143
当前符合要求的哈希值为:000002d787d820a22917c7fba27d7830
Difficulty为:5, 挖矿时间 = 2.095510s, 挖矿步长 = 1037417
当前取的随机整数为:3858887685
当前符合要求的哈希值为:00000811ef0537af372281efa5ab6e70
Difficulty为:5, 挖矿时间 = 0.903285s, 挖矿步长 = 452313
Difficulty为5, 挖矿平均时间=1.369598s, 挖矿平均步长 = 680351.00
当前取的随机整数为:560622301
当前符合要求的哈希值为:000000ea1edd9ff7861bf3a2bf036035
Difficulty为:6, 挖矿时间 = 27.123144s, 挖矿步长 = 13322296
当前取的随机整数为:915009941
当前符合要求的哈希值为:0000005b227d8483720a088546b10788
Difficulty为:6, 挖矿时间 = 78.107471s, 挖矿步长 = 39547641
当前取的随机整数为:559022943
当前符合要求的哈希值为:0000007af522c8be3b7eb07d1b1f4962
Difficulty为:6, 挖矿时间 = 66.201216s, 挖矿步长 = 33511112
Difficulty为6, 挖矿平均时间=57.143944s, 挖矿平均步长 = 28793683.00
当前取的随机整数为:2322849657
当前符合要求的哈希值为:00000002fc2d0273ec3071186adb1c38
Difficulty为:7, 挖矿时间 = 28.462335s, 挖矿步长 = 14691452
当前取的随机整数为:223159771
当前符合要求的哈希值为:0000000d5dfa5421c2d57b848e518e6b
Difficulty为:7, 挖矿时间 = 369.015444s, 挖矿步长 = 190136615
当前取的随机整数为:1417598154
当前符合要求的哈希值为:000000077d321f5e0b2589707498a28f
Difficulty为:7, 挖矿时间 = 1054.435191s, 挖矿步长 = 551187133
Difficulty为7, 挖矿平均时间=483.970990s, 挖矿平均步长 = 252005066.67
+----------------+-----------------+--------------------+
| Difficulty (d) | 挖矿平均时间(s) | 挖矿平均步长(step) |
+----------------+-----------------+--------------------+
|       1        |     0.000000    |        5.67        |
|       2        |     0.000666    |       279.00       |
|       3        |     0.009444    |      4977.67       |
|       4        |     0.042987    |      22105.67      |
|       5        |     1.369598    |     680351.00      |
|       6        |    57.143944    |    28793683.00     |
|       7        |    483.970990   |    252005066.67    |
+----------------+-----------------+--------------------+

```



#### 5.3.2 sha1运行结果



```
使用哈希算法: SHA1
当前取的随机整数为:844843624
当前符合要求的哈希值为:0313a8d940a33a96717b29d8ad838073c7193fd2
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 25
当前取的随机整数为:3910347792
当前符合要求的哈希值为:092f1e368584d61f641e54ae3f7cb504c9f88e2a
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 30
当前取的随机整数为:2991040307
当前符合要求的哈希值为:0b9cdd4cd02d422df44e44a6b0e3d9b519285cf6
Difficulty为:1, 挖矿时间 = 0.000000s, 挖矿步长 = 10
Difficulty为1, 挖矿平均时间=0.000000s, 挖矿平均步长 = 21.67
当前取的随机整数为:638679685
当前符合要求的哈希值为:0070bc96eb57f2feda2cec1f27aa5a52caecf91f
Difficulty为:2, 挖矿时间 = 0.001015s, 挖矿步长 = 589
当前取的随机整数为:1258062951
当前符合要求的哈希值为:00430601f0fcb09741165f658210b8aba4e03ba5
Difficulty为:2, 挖矿时间 = 0.000999s, 挖矿步长 = 169
当前取的随机整数为:1690295178
当前符合要求的哈希值为:00b355130a0057420e6e4f2eb3e49047c1d78e95
Difficulty为:2, 挖矿时间 = 0.000000s, 挖矿步长 = 26
Difficulty为2, 挖矿平均时间=0.000671s, 挖矿平均步长 = 261.33
当前取的随机整数为:2099738847
当前符合要求的哈希值为:000e50cd8e8f5b64c91da3c8ed65197ad5acd99f
Difficulty为:3, 挖矿时间 = 0.012966s, 挖矿步长 = 6780
当前取的随机整数为:1334107417
当前符合要求的哈希值为:000e6453051463bf35a0177a4d83a607d42d7102
Difficulty为:3, 挖矿时间 = 0.001994s, 挖矿步长 = 676
当前取的随机整数为:953502034
当前符合要求的哈希值为:000dbfd5c37bebd35ce71fef28ef75a882ab08f3
Difficulty为:3, 挖矿时间 = 0.000000s, 挖矿步长 = 178
Difficulty为3, 挖矿平均时间=0.004987s, 挖矿平均步长 = 2544.67
当前取的随机整数为:1733183438
当前符合要求的哈希值为:0000b8aba3abca6c3b5e87fc3983eae6c4999115
Difficulty为:4, 挖矿时间 = 0.272183s, 挖矿步长 = 134615
当前取的随机整数为:1681519120
当前符合要求的哈希值为:0000515b7b802bccaa88ea3eb1d7d308e18959b5
Difficulty为:4, 挖矿时间 = 0.215496s, 挖矿步长 = 109137
当前取的随机整数为:1632215681
当前符合要求的哈希值为:0000d86af8840e023b619cda4f1bbb5b1fe2fc3d
Difficulty为:4, 挖矿时间 = 0.096825s, 挖矿步长 = 48348
Difficulty为4, 挖矿平均时间=0.194835s, 挖矿平均步长 = 97366.67
当前取的随机整数为:108570613
当前符合要求的哈希值为:00000e891f08f51531bf5feb8076df2dd990c63a
Difficulty为:5, 挖矿时间 = 0.286432s, 挖矿步长 = 141911
当前取的随机整数为:4247102227
当前符合要求的哈希值为:00000781c82a2487ceb9f1e0d07939826372b5cf
Difficulty为:5, 挖矿时间 = 0.141405s, 挖矿步长 = 71979
当前取的随机整数为:3509510494
当前符合要求的哈希值为:00000420325ecbd8b795f6704d151a8269489047
Difficulty为:5, 挖矿时间 = 2.420480s, 挖矿步长 = 1233477
Difficulty为5, 挖矿平均时间=0.949439s, 挖矿平均步长 = 482455.67
当前取的随机整数为:193243168
当前符合要求的哈希值为:0000002c86f001fc636a315b0e0950dd55b1da11
Difficulty为:6, 挖矿时间 = 29.453508s, 挖矿步长 = 15016508
当前取的随机整数为:2383486212
当前符合要求的哈希值为:000000c19865f899a367c3ae0dd1dc18e4fbb7fe
Difficulty为:6, 挖矿时间 = 62.318737s, 挖矿步长 = 31798617
当前取的随机整数为:4214999933
当前符合要求的哈希值为:0000007e7cd33514f2df5703676aa2547dcdeebd
Difficulty为:6, 挖矿时间 = 4.961336s, 挖矿步长 = 2525645
Difficulty为6, 挖矿平均时间=32.244527s, 挖矿平均步长 = 16446923.33
当前取的随机整数为:1186363826
当前符合要求的哈希值为:000000071ac168bf4b70c4bb66f5eec9d9b375f9
Difficulty为:7, 挖矿时间 = 1412.240557s, 挖矿步长 = 719181884
当前取的随机整数为:1322938814
当前符合要求的哈希值为:000000070fc1c93ed06810a2f759ef7b7f4a1606
Difficulty为:7, 挖矿时间 = 1158.246920s, 挖矿步长 = 589540809
当前取的随机整数为:2973730295
当前符合要求的哈希值为:00000000d7edda3e3b7e9b77139b4c5ba3088a71
Difficulty为:7, 挖矿时间 = 1646.683069s, 挖矿步长 = 835014537
Difficulty为7, 挖矿平均时间=1405.723516s, 挖矿平均步长 = 714579076.67
+----------------+-----------------+--------------------+
| Difficulty (d) | 挖矿平均时间(s)   | 挖矿平均步长(step)    |
+----------------+-----------------+--------------------+
|       1        |     0.000000    |       21.67        |
|       2        |     0.000671    |       261.33       |
|       3        |     0.004987    |      2544.67       |
|       4        |     0.194835    |      97366.67      |
|       5        |     0.949439    |     482455.67      |
|       6        |    32.244527    |    16446923.33     |
|       7        |   1405.723516   |    714579076.67    |
+----------------+-----------------+--------------------+
```



### 5.4 gpu加速

。。。

`cuda`、`numba` 





## 6. AirDrop泄露

### 6.0 简述

在做`2022网鼎杯Crypto`的时候发现一道题目



`AirDrop`是苹果公司推出的一项无线传输功能



当用户启动 `AirDrop` 功能时，苹果会将用户电话号码、电子邮箱以加密形式传播到其 Wi-Fi 和蓝牙范围内，以检测附近可连接设备。



如果用户与另一设备通过 `AirDrop` 匹配成功，双方将会交换电话和电子邮件信息的完整的加密散列（SHA-256 散列）。



2019年左右，达姆施塔特工业大学的研究人员发现，该功能用于查找和验证某人的过程可能会暴露用户的联系人信息，可能将用户 Apple 账号绑定的电话号码和电子邮箱泄露给附近的苹果设备。



这个漏洞发表在安全顶会`USENIX Security 2021` 

`PrivateDrop: Practical Privacy-Preserving Authentication for Apple AirDrop`

![image-20241121105303471](../_media/image-20241121105303471.png)





### 6.1 哈希碰撞

然后它可以这样利用：

假设不知道你的手机号码，但是可以通过社工进行得知，你是首批放号的中国联通号码

实际情况下可以是任意条件，如果是熟人作案的话更快拿到信息

现在截取了一段AirDrop传输的时候泄露的哈希值，那我们可以通过哈希碰撞进行查找你的手机号码



具体详情很复杂，这里给一个最简单的演示：

```python
import hashlib

target_hash = 'c22a563acc2a587afbfaaaa6d67bc6e628872b00bd7e998873881f7c6fdc62fc'
start = 8617000000000
end = 8617099999999

for i in range(end,start,-1):
    plainText = str(i)
    cipherText = hashlib.sha256(plainText.encode('utf-8')).hexdigest()
    
    if cipherText == target_hash:
        print("碰撞成功:")
        print("密文为:", cipherText)
        print("明文为:", plainText)
        break
    else:
        print("碰撞中-------",i)
```

运行结果：

```
密文为: c22a563acc2a587afbfaaaa6d67bc6e628872b00bd7e998873881f7c6fdc62fc
明文为: 8617091733716
```

<img src="../_media/image-20241121113632229.png" alt="image-20241121113632229" style="zoom:150%;" />





找到号码，最直接就是社工库寻找，就可以一大堆的信息出来了。



### 6.2 利用方式

跑出来结果，后续是继续收集信息，还是社工库找人，或是钓鱼、信息售卖都有可能被利用。

泄露的哈希值不仅仅是手机号码，还有邮箱等等。

黑客可以在笔记本电脑上放置一份预先编译的电话号码散列清单，然后坐在公共场所附近，尝试建立 AirDrop 连接，被动或主动收集附近 iPhone 信息。

一种是最简单、最强大的被动攻击。攻击者只需要监控附近开启隔空投送的用户，就可以获得其电话号码、电子邮箱，而无需提前预知任何信息。



<br>











