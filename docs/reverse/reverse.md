# reverse



## CTFç«èµ›ä¸­çš„é€†å‘å®šä¹‰ï¼š

æ¶‰åŠWindowsã€Linuxã€Androidå¹³å°çš„å¤šç§ç¼–ç¨‹æŠ€æœ¯ï¼Œè¦æ±‚åˆ©ç”¨å¸¸ç”¨å·¥å…·å¯¹æºä»£ç åŠäºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œé€†å‘åˆ†æï¼ŒæŒæ¡Androidç§»åŠ¨åº”ç”¨APKæ–‡ä»¶çš„é€†å‘åˆ†æï¼ŒæŒæ¡åŠ è§£å¯†ã€å†…æ ¸ç¼–ç¨‹ã€ç®—æ³•ã€åè°ƒè¯•å’Œä»£ç æ··æ·†æŠ€æœ¯ã€‚â€”â€”ã€Šå…¨å›½å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç«èµ›å‚èµ›æŒ‡å—ã€‹



ctfé€†å‘èµ›é¢˜çš„å…±åŒç‚¹

è¾“å…¥xï¼Œæ•°æ®å¤„ç†ï¼Œåˆ¤æ–­è¾“å…¥æ˜¯å¦æ­£ç¡®



## å¸¸è§„é€†å‘æµç¨‹

- ä½¿ç”¨strings/file/binwalk/strace ç­‰å·¥å…·æ”¶é›†ä¿¡æ¯ï¼ˆLinuxï¼‰ä¸‹çš„stringséå¸¸å¥½ç”¨ï¼Œå®¹æ˜“å‡ºç°éé¢„æœŸï¼Œæœé›†ä¿¡æ¯è¿›è¡Œç½‘ä¸ŠæŸ¥è¯¢
- åˆ¤æ–­æ˜¯å¦å­˜åœ¨ä»£ç æ··æ·†ã€åŠ å£³ã€åè°ƒè¯•ï¼Œè®¾æ³•ç ´é™¤
- é™æ€åˆ†æï¼Œå®šä½å…³é”®ä»£ç 
- åŠ¨æ€è°ƒè¯•ï¼ŒéªŒè¯é™æ€åˆ†æçŒœæƒ³
- æ­£å‘ç®—æ³•æ¨ç†é€†å‘ç®—æ³•
- pythonè„šæœ¬æ±‚è§£flag



å·¥å…·ï¼š

exeinfo peã€idaã€DIEã€gdb



åæ±‡ç¼–

åç¼–è¯‘

åŠ¨æ€è°ƒè¯•





## å‡ºé¢˜æ€è·¯

- æ€æ ·æ¥å—ç”¨æˆ·è¾“å…¥ï¼Œå°±å¯ä»¥åˆ’åˆ†å‡ºé¢˜æ–¹å¼
- ä»¥ä»€ä¹ˆå½¢å¼æ¥å˜å¤„ç†æ•°æ®ï¼ŒåŠ å£³ä¹‹ç±»
- åˆ¤æ–­è¾“å…¥æ˜¯å¦æ­£ç¡®ï¼Œç›´æ¥è¾“å‡ºflagã€è¾“å…¥å°±æ˜¯flagã€è¾“å…¥å˜æ¢ä¹‹åå°±æ˜¯flagï¼ˆbase64ä¹‹ç±»





## åŸºç¡€çŸ¥è¯†ç‚¹

### IDAï¼š

é€šè¿‡FLIRTç®—æ³•ï¼Œè¯†åˆ«å‡½æ•°é¦–å°¾çš„å­—èŠ‚ç‰¹å¾ï¼Œå°†æœºå™¨ç ç¿»è¯‘æˆé™æ€åº“å‡½æ•°çš„è°ƒç”¨ã€‚



### PEå’ŒELFï¼š

| PE   | ELF  |
| ---- | ---- |
| .exe | elf  |
| .dll | .so  |
| .lib | .a   |



### NOPï¼š

x86 CPUä¸Šçš„NOPæŒ‡ä»¤å®è´¨ä¸Šæ˜¯XCHG EAX æœºå™¨ç 0x90





### x86å’Œx64çš„åŒºåˆ«ï¼š

x86è¡¨ç¤º32ä½æœºå™¨ï¼Œx64è¡¨ç¤º64ä½æœºå™¨

x86å°±æ˜¯Intelï¼Œx64å°±æ˜¯AT&T



### æœºå™¨ç å’Œæ±‡ç¼–è¯­è¨€ï¼š

æœºå™¨ç å°±æ˜¯CPUä¸Šç›´æ¥æ‰§è¡Œçš„äºŒè¿›åˆ¶æŒ‡ä»¤

æ±‡ç¼–è¯­è¨€å°±æ˜¯æœºå™¨è¯­è¨€çš„åŠ©è®°ç¬¦

ä¸€èˆ¬å°±æ˜¯x86å’Œx86-64





### x86å¯„å­˜å™¨ï¼š

æ—©æœŸx86CPUåªæœ‰8ä¸ªå¯„å­˜å™¨ï¼Œç°åœ¨100å¤šä¸ªå¯„å­˜å™¨éƒ½å˜ä¸ºé€šç”¨å¯„å­˜å™¨ã€‚

- EAX
- EBX
- ECX
- EDX
- EDI
- ESI
- EBP
- ESP

å‰ä¸ƒä¸ªéƒ½æ˜¯é€šç”¨çš„å¯„å­˜å™¨ï¼Œæœ€åä¸€ä¸ªESPç”¨æ¥ä¿å­˜å½“å‰Stackçš„åœ°å€

| é€šç”¨å¯„å­˜å™¨     | EAX  | RBX  | ECX  | EDX  | ESI  | EDI  |
| -------------- | ---- | ---- | ---- | ---- | ---- | ---- |
| æ ˆé¡¶æŒ‡é’ˆå¯„å­˜å™¨ | ESP  |      |      |      |      |      |
| æ ˆåº•æŒ‡é’ˆå¯„å­˜å™¨ | EBP  |      |      |      |      |      |
| æŒ‡ä»¤è®¡æ•°å™¨     | EIP  |      |      |      |      |      |
| æ®µå¯„å­˜å™¨       | CS   | DS   | SS   | ES   | FS   | GS   |



### x86-64å¯„å­˜å™¨ï¼š



| é€šç”¨å¯„å­˜å™¨     | RAX  | RBX  | RCX  | RDX  | RSI  | RDI  | R8-R15 |
| -------------- | ---- | ---- | ---- | ---- | ---- | ---- | ------ |
| æ ˆé¡¶æŒ‡é’ˆå¯„å­˜å™¨ | RSP  |      |      |      |      |      |        |
| æ ˆåº•æŒ‡é’ˆå¯„å­˜å™¨ | RBP  |      |      |      |      |      |        |
| æŒ‡ä»¤è®¡æ•°å™¨     | RIP  |      |      |      |      |      |        |
| æ®µå¯„å­˜å™¨       | CS   | DS   | SS   | ES   | FS   | GS   |        |



### 16ä½å¯„å­˜å™¨ï¼š



| é€šç”¨å¯„å­˜å™¨     | AX   | BX   | CX   | DX   | SI   | DI   |
| -------------- | ---- | ---- | ---- | ---- | ---- | ---- |
| æ ˆé¡¶æŒ‡é’ˆå¯„å­˜å™¨ | SP   |      |      |      |      |      |
| æ ˆåº•æŒ‡é’ˆå¯„å­˜å™¨ | BP   |      |      |      |      |      |
| æŒ‡ä»¤è®¡æ•°å™¨     | IP   |      |      |      |      |      |
| æ®µå¯„å­˜å™¨       | CS   | DS   | SS   | ES   | FS   | GS   |



### è°ƒç”¨çº¦å®šï¼š

x86 32ä½

__cdecl : å‚æ•°ä»å³å‘å·¦ä¾æ¬¡å‹å…¥æ ˆï¼Œè°ƒç”¨å®Œæ¯•åï¼Œç”±è°ƒç”¨è€…è´Ÿè´£å°†è¿™äº›å‹å…¥çš„å‚æ•°æ¸…ç†ï¼Œè¿”å›å€¼ä½äºEAXä¸­ã€‚

__stdcal : å‚æ•°ä»å³å‘å·¦ä¾æ¬¡å‹å…¥æ ˆï¼Œè°ƒç”¨å®Œæ¯•åï¼Œç”±è¢«è°ƒç”¨è€…è´Ÿè´£å°†è¿™äº›å‹å…¥çš„å‚æ•°æ¸…ç†ï¼Œè¿”å›å€¼ä½äºEAXä¸­ã€‚

__thiscall : ç±»æ–¹æ³•ï¼Œå°†thisæŒ‡é’ˆæ”¾å…¥ECXï¼Œå‹å…¥æ ˆ

__fastcall : åŠ é€Ÿè°ƒç”¨ï¼Œå°†ç¬¬ä¸€ä¸ªå‚æ•°æ”¾å…¥ECXï¼Œç¬¬äºŒä¸ªæ”¾å…¥EDXï¼Œä¾æ¬¡å…¥æ ˆ



x86-x64

Microsoft x64 å‰å››ä¸ªå‚æ•°æ”¾å…¥RDI\RSI\RDX\RCXï¼Œå‰©ä¸‹çš„å‚æ•°ä»å³åˆ°å·¦ä¾æ¬¡å‹å…¥æ ˆä¸­

SystemV x64 åœ¨Linux MacOSä¸Šä½¿ç”¨ï¼Œæ¯”Microsoft  å¤šäº†ä¸¤ä¸ªå¯„å­˜å™¨ï¼Œä½¿ç”¨RDIã€RSIã€RDXã€R8ã€R9ï¼Œå‰©ä¸‹çš„å‚æ•°ä»å³åˆ°å·¦ä¾æ¬¡å‹å…¥æ ˆä¸­







## æ±‡ç¼–è¯­è¨€ï¼š

![image-20241023212206638](../_media/image-20241023212206638.png)





## ä¿æŠ¤å£³

åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå…ˆäºç¨‹åºè¿è¡Œï¼Œæ‹¿åˆ°æ§åˆ¶æƒï¼Œä»»ä½•ä¿æŠ¤å¹¶åŠ è½½ç¨‹åºã€‚

åŠ å£³å°±æ˜¯åˆ©ç”¨ç‰¹æ®Šçš„ç®—æ³•ï¼Œå¯¹exeã€dllæ–‡ä»¶é‡Œçš„èµ„æºè¿›è¡Œå‹ç¼©ã€‚ç±»ä¼¼winzipæ•ˆæœ



åˆ†ç±»ï¼š

- å‹ç¼©å£³ï¼šé€šè¿‡å‹ç¼©ç®—æ³•å‹ç¼©è½¯ä»¶å¤§å°
- åŠ å¯†å£³ï¼šåˆ©ç”¨å„ç§åè·Ÿè¸ªæŠ€æœ¯ä¿æŠ¤ç¨‹åºä¸è¢«è°ƒè¯•ã€è„±å£³ã€åç¼–è¯‘



ç±»å‹ï¼š

- unpack -> execute å…¨éƒ¨ç¨‹åºä»£ç è§£å‹åˆ°å†…å­˜ä¸­å†ç»§ç»­æ‰§è¡Œç¨‹åºä»£ç 
- unpack -> execute->unpack->execute ...  è§£å‹éƒ¨åˆ†ä»£ç ï¼Œè¾¹è§£å‹è¾¹æ‰§è¡Œä»£ç 
- unpack->[decoder | encoded code]->decode->execute ç¨‹åºä»£ç ç¼–ç ï¼Œè§£å‹åå†è¿è¡Œå’Œæ‹¿ä¹¦å°†çœŸæ­£çš„ç¨‹åºä»£ç è§£ç æ‰§è¡Œ























## æ¡ˆä¾‹



[ã€æ”»é˜²ä¸–ç•Œã€‘crypt | å å…¥æ˜Ÿé‡çš„æœˆğŸŒ™](https://www.uf4te.cn/posts/5bfdd0f4.html)

æ”»é˜²ä¸–ç•Œcryptï¼Œä¸€ä¸ªå¾ˆå¥½çš„wp





### æ¡ˆä¾‹ä¸€



ctfshow-re3

```
int __cdecl main(int argc, const char **argv, const char **envp)
{
  size_t v3; // rax
  int v5; // [rsp+Ch] [rbp-134h] BYREF
  unsigned int i; // [rsp+10h] [rbp-130h]
  int v7; // [rsp+14h] [rbp-12Ch]
  int v8; // [rsp+18h] [rbp-128h]
  int v9; // [rsp+1Ch] [rbp-124h]
  int v10; // [rsp+20h] [rbp-120h]
  int v11; // [rsp+24h] [rbp-11Ch]
  int v12; // [rsp+28h] [rbp-118h]
  int v13; // [rsp+2Ch] [rbp-114h]
  int v14; // [rsp+30h] [rbp-110h]
  int v15; // [rsp+34h] [rbp-10Ch]
  unsigned __int64 v16; // [rsp+38h] [rbp-108h]
  int v17[8]; // [rsp+40h] [rbp-100h]
  char s[5]; // [rsp+60h] [rbp-E0h] BYREF
  char v19[107]; // [rsp+65h] [rbp-DBh] BYREF
  char dest[104]; // [rsp+D0h] [rbp-70h] BYREF
  unsigned __int64 v21; // [rsp+138h] [rbp-8h]

  v21 = __readfsqword(0x28u);
  v7 = 80;
  v8 = 64227;
  v9 = 226312059;
  v10 = -1540056586;
  v11 = 5;
  v12 = 16;
  v13 = 3833;
  v5 = 0;
  puts("plz input the key:");
  __isoc99_scanf("%s", s);
  v3 = strlen(s);
  strncpy(dest, v19, v3 - 6);
  dest[strlen(s) - 6] = 0;
  __isoc99_sscanf(dest, "%x", &v5);
  v17[0] = v7;
  v17[1] = v8;
  v17[2] = v9;
  v17[3] = v10;
  v17[4] = (v11 << 12) + v12;
  v17[5] = v13;
  v17[6] = v5;
  v16 = 0LL;
  for ( i = 0; i <= 6; ++i )
  {
    for ( v16 += (unsigned int)v17[i]; v16 > 0xFFFF; v16 = v15 + (unsigned int)(unsigned __int16)v16 )
    {
      v14 = (unsigned __int16)v16;
      v15 = v16 >> 16;
    }
  }
  if ( v16 == 0xFFFF )
    puts("OK");
  else
    puts("Error");
  return 0;
}
```



é€†å‘ç¨‹åºï¼š

```python
for i in range(0xffff):
    v17 = [80,64227,226312059,0xA43499F6,(5 << 12) + 16,3833, i]
    v16 = 0
    
    for j in range(7):
        v16 += v17[j]
        while v16 > 0xffff:
            v15 = v16 >> 16
            v16 = (v15 + (v16 & 0xffff)) & 0xffffffff
            
    if v16 == 0xffff:
        print(hex(i))
```





### æ¡ˆä¾‹äºŒ



```c
void __fastcall __noreturn sub_1400010E0(char *a1, __int64 a2)
{
  int v2; // er9
  __int64 v3; // r8
  char *v4; // r10
  char v5; // al
  __int64 v6; // rbx
  char v7; // cl
  char v8; // [rsp+1Fh] [rbp-3F9h]
  char v9; // [rsp+20h] [rbp-3F8h] BYREF

  v2 = 0;
  v3 = (__int64)a1;
  if ( a1 )
  {
    v4 = &v9;
    do
    {
      ++v4;
      ++v2;
      a1 = &a4890572163qwe[-26 * (v3 / 26)];    // // )(*&^%489$!057@#><:2163qwe
      v5 = a1[v3];
      v3 /= 26i64;
      a2 = v3;
      *(v4 - 1) = v5;
    }
    while ( v3 );
  }
  v6 = v2;
  while ( v6 )
  {
    v7 = *(&v8 + v6--);
    sub_1400011E0(v7 ^ 7);
  }
  ((void (__fastcall __noreturn *)(char *, __int64, __int64))sub_140001220)(a1, a2, v3);
}
```



```c
void __noreturn sub_140001220()
{
  __int64 v0; // r9
  int v1; // ecx
  __int64 v2; // rdx
  char v3; // al
  int v4; // er8
  __int64 v5; // r9
  char v6; // cl
  int v7; // eax

  v0 = qword_140004620;
  v1 = 0;
  v2 = 0i64;
  while ( 1 )
  {
    v3 = *(_BYTE *)v0;
    v4 = v1 + 1;
    v5 = *(_QWORD *)(v0 + 8);
    if ( v3 != aV4pY59[v2 - 1] )
      v4 = v1;
    qword_140004620 = v5;
    if ( !v5 )
      break;
    v6 = *(_BYTE *)v5;
    v7 = v4 + 1;
    v0 = *(_QWORD *)(v5 + 8);
    if ( v6 != aV4pY59[v2] )
      v7 = v4;
    qword_140004620 = v0;
    if ( v0 )
    {
      v2 += 2i64;
      v1 = v7;
      if ( v2 < 14 )
        continue;
    }
    goto LABEL_11;
  }
  v7 = v4;
LABEL_11:
  if ( v7 == 14 )
    sub_1400012E0();
  sub_1400012B0();
}
```





é€†å‘ç¨‹åºï¼š

```python
table = ')(*&^%489$!057@#><:2163qwe'
check = '/..v4p$$!>Y59-'
for i in range(len(check)):
    d = ''
    d += chr(ord(check[i])^7)
d = '())q3w##&9^2>*'         #dä¸ºå¼‚æˆ–7ä¹‹åçš„ç»“æœ
for i in range(len(d)):
    c = 0
    c = table.index(d[i])      #cä¸ºdåœ¨tableè¡¨ä¸­å¯¹åº”çš„å„ä¸ªç´¢å¼•å€¼
c = [1,0,0,23,22,24,15,15,3,8,4,19,16,2]
flag = 0
for i in range(len(c)):
    flag *= 26
    flag += c[i]
print(flag)
```







### 2018ç½‘é¼beijing

```python
a=[0x61,0x4C,0x67,0x59,0x69,0x29,0x6E,0x42,0x62,0x0D,0x65,0x71,0x66,0x34,0x6A,0x0C6,0x6D,0x8A,0x6C,0x7F,0x7B,0x0AE,0x7A,0x92,0x7D,0x0EC,0x5F,0x657]
f=a[0:28:2]

list = [0x6,0x9,0x0,0x1,0xa,0x0,0x8,0x0,0xb,0x2,0x3,0x1,0xd,0x4,0x5,0x2,0x7,0x2,0x3,0x1,0xc]

result = ''
for i in range(21):
    char = chr(f[list[i]])
    result += char

print(result)
```







## Cè¯­è¨€å‡½æ•°ç‰¹è¾‘



### memsetï¼ˆï¼‰

==memset() å‡½æ•°å°†æŒ‡å®šçš„å€¼ c å¤åˆ¶åˆ° str æ‰€æŒ‡å‘çš„å†…å­˜åŒºåŸŸçš„å‰ n ä¸ªå­—èŠ‚ä¸­ï¼Œè¿™å¯ä»¥ç”¨äºå°†å†…å­˜å—æ¸…é›¶æˆ–è®¾ç½®ä¸ºç‰¹å®šå€¼ã€‚==

```c
void *memset(void *str, int c, size_t n)
```



```c
   strcpy(str,"This is string.h library function");
   memset(str,'$',7);
    This is string.h library function
    $$$$$$$ string.h library function
```





### strcmpï¼ˆï¼‰

C åº“å‡½æ•° **int strcmp(const char \*str1, const char \*str2)** æŠŠ **str1** æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²å’Œ **str2** æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒã€‚

```
int strcmp(const char *str1, const char *str2)
```

- å¦‚æœè¿”å›å€¼å°äº 0ï¼Œåˆ™è¡¨ç¤º str1 å°äº str2ã€‚
- å¦‚æœè¿”å›å€¼å¤§äº 0ï¼Œåˆ™è¡¨ç¤º str1 å¤§äº str2ã€‚
- å¦‚æœè¿”å›å€¼ç­‰äº 0ï¼Œåˆ™è¡¨ç¤º str1 ç­‰äº str2ã€‚



### strncpyï¼ˆï¼‰

```c
char *strncpy(char *dest, const char *src, size_t n)
```

- **dest** -- æŒ‡å‘ç”¨äºå­˜å‚¨å¤åˆ¶å†…å®¹çš„ç›®æ ‡æ•°ç»„ã€‚
- **src** -- è¦å¤åˆ¶çš„å­—ç¬¦ä¸²ã€‚
- **n** -- è¦ä»æºä¸­å¤åˆ¶çš„å­—ç¬¦æ•°ã€‚





### strcpyï¼ˆï¼‰

```c
char *strcpy(char *dest, const char *src)
```

C åº“å‡½æ•° **char \*strcpy(char \*dest, const char \*src)** æŠŠ **src** æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²å¤åˆ¶åˆ° **dest**ã€‚

- **dest** -- æŒ‡å‘ç”¨äºå­˜å‚¨å¤åˆ¶å†…å®¹çš„ç›®æ ‡æ•°ç»„ã€‚
- **src** -- è¦å¤åˆ¶çš„å­—ç¬¦ä¸²ã€‚



```c
#include <stdio.h>
#include <string.h>
 
int main ()
{
  char str1[]="Sample string";
  char str2[40];
  char str3[40];
  strcpy (str2,str1);
  strcpy (str3,"copy successful");
  printf ("str1: %s\nstr2: %s\nstr3: %s\n",str1,str2,str3);
  return 0;
}
```



finall

```
str1: Sample string
str2: Sample string
str3: copy successful
```



### strcatï¼ˆï¼‰

```c
char *strcat(char *dest, const char *src)
```

- **dest** -- æŒ‡å‘ç›®æ ‡æ•°ç»„ï¼Œè¯¥æ•°ç»„åŒ…å«äº†ä¸€ä¸ª C å­—ç¬¦ä¸²ï¼Œä¸”è¶³å¤Ÿå®¹çº³è¿½åŠ åçš„å­—ç¬¦ä¸²ã€‚
- **src** -- æŒ‡å‘è¦è¿½åŠ çš„å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²ä¸ä¼šè¦†ç›–ç›®æ ‡å­—ç¬¦ä¸²ã€‚



```c
#include <stdio.h>
#include <string.h>
 
int main ()
{
   char src[50], dest[50];
 
   strcpy(src,  "This is source");
   strcpy(dest, "This is destination");
 
   strcat(dest, src);
 
   printf("æœ€ç»ˆçš„ç›®æ ‡å­—ç¬¦ä¸²ï¼š |%s|", dest);
   
   return(0);
}
```

```
æœ€ç»ˆçš„ç›®æ ‡å­—ç¬¦ä¸²ï¼š |This is destinationThis is source|
```





## IDA-Python



```
print(hex(idc.here()))          #è·å–å½“å‰åœ°å€
print(hex(idc.get_screen_ea())) #å¦ä¸€ç§è·å–å½“å‰åœ°å€çš„å‡½æ•°
print(hex(ida_ida.inf_get_min_ea())) #è·å–å½“å‰æœ€å°åœ°å€
print(hex(ida_ida.inf_get_max_ea())) #è·å–å½“å‰æœ€å¤§åœ°å€
print(hex(idc.read_selection_start()))#å¦‚æœä½ é€‰æ‹©äº†æŸå—åœ°å€ é‚£ä¹ˆä½¿ç”¨æ­¤å‡½æ•°åˆ™è¿”å›ä½ é€‰æ‹©çš„è¿™å—åœ°å€çš„èµ·å§‹åœ°å€
print(hex(idc.read_selection_end())) #åŒä¸Š è¿”å›ç»“æŸåœ°å€.
 
if idaapi.BADADDR == idc.here(): 
    print("BadAddress addr invalid")
else: 
    print("addr is ok")
```



| å‡½æ•°            | è¯´æ˜                        |
| --------------- | --------------------------- |
| **Byte(addr)**  | ä»¥å­—èŠ‚ä¸ºå•ä½è·å–åœ°å€å¤„çš„å€¼  |
| **Word(addr)**  | åŒä¸Š. ä»¥2å­—èŠ‚(å­—)çš„å•ä½è·å– |
| **Dword(addr)** | 4å­—èŠ‚                       |
| **Qword(addr)** | 8å­—èŠ‚                       |



è„šæœ¬æ¡ˆä¾‹ï¼š





## ä»£ç æ··æ·†

ä½¿ç”¨OLLVMã€movfuscatorï¼ŒèŠ±æŒ‡ä»¤ï¼Œè™šæ‹ŸåŒ–ã€SMCç­‰å·¥å…·è¿›è¡Œæ··æ·†





## SMC

SMCï¼Œself modifying code åŠ¨æ€ä»£ç åŠ å¯†æŠ€æœ¯

åŠ å¯†æ–¹å¼ï¼š

- ä¿®æ”¹PEæ–‡ä»¶çš„Section Header
- ä½¿ç”¨API Hookå®ç°ä»£ç çš„åŠ è§£å¯†
- ä½¿ç”¨VMProtectç­‰ç¬¬ä¸‰æ–¹åŠ å¯†å·¥å…·





å¼‚æˆ–åŠ å¯†

VirtualProtect æ˜¯ Windows æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ª API å‡½æ•°ï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºæ”¹å˜ä¸€ä¸ªå†…å­˜é¡µçš„ä¿æŠ¤å±æ€§ã€‚



å‡½æ•°åŸå‹ï¼š

```c
BOOL VirtualProtect(
  LPCVOID lpAddress,  // è¦æ”¹å˜ä¿æŠ¤å±æ€§çš„å†…å­˜é¡µçš„èµ·å§‹åœ°å€
  SIZE_T dwSize,      // å†…å­˜é¡µçš„å¤§å°
  DWORD flNewProtect, // æ–°çš„ä¿æŠ¤å±æ€§
  PDWORD lpflOldProtect // å­˜å‚¨æ—§çš„ä¿æŠ¤å±æ€§
);
```



## Unityå¤–æŒ‚

Unityæ¸¸æˆ

å…¸å‹æ¸¸æˆï¼šç‹è€…è£è€€ã€åŸç¥ã€æ°¸åŠ«æ— é—´ã€æ˜æ—¥æ–¹èˆŸã€æ£®æ—ä¹‹å­







## è„±å£³æ­¥éª¤ 

æ‹–è¿›OD

è¿æ°”å·å¯ä»¥ç›´æ¥çœ‹åˆ°jmpï¼Œæˆ–è€…ç­¾åˆ°é¢˜

ESPå®šå¾‹æ–¹æ³•æ‰¾OEP



æ‰¾ popad

ç›´æ¥æ‰¾åˆ°ä¸‹é¢çš„ä¸€ä¸ªjmpï¼Œç„¶åä¸‹ä¸€ä¸ªæ–­ç‚¹

F2 ä¸‹æ–­ç‚¹

![image-20241024210604659](../_media/image-20241024210604659.png)

F9 è¿è¡Œåˆ°è¿™é‡Œ

![image-20241024210631754](../_media/image-20241024210631754.png)

F8 è·³è½¬åˆ°OEP

![image-20241024210652516](../_media/image-20241024210652516.png)

ç„¶åé¼ æ ‡å³é”®ï¼Œä½¿ç”¨æ’ä»¶è„±å£³

![image-20241024210718082](../_media/image-20241024210718082.png)

ç„¶åå¦å­˜å³å¯ï¼Œæ‹–è¿›idaçœ‹ä¸€ä¸‹ï¼Œè™½ç„¶æœ‰upxçš„å‡½æ•°æ ‡è¯†ï¼Œä½†æ˜¯ä»£ç ç¡®å®æ˜¯è„±å£³æˆåŠŸäº†ã€‚

